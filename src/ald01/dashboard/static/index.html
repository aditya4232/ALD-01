<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ALD-01 | Autonomous Dev Assistant</title>
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">
    
    <!-- Icons (Lucide) -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <!-- Styles -->
    <link rel="stylesheet" href="/static/styles.css">
</head>
<body>

<div class="app-layout">
    
    <!-- Sidebar Navigation -->
    <aside class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <div class="sidebar-logo">AL</div>
            <div class="sidebar-title">ALD-01 Dashboard</div>
            <button class="btn btn-icon btn-ghost" id="toggle-sidebar" style="margin-left: auto;">
                <i data-lucide="panel-left-close"></i>
            </button>
        </div>
        
        <div class="sidebar-nav">
            <!-- Main Group -->
            <div class="nav-section">
                <div class="nav-section-label">Core</div>
                <div class="nav-item active" data-page="chat">
                    <i data-lucide="message-square"></i>
                    <span>Chat Engine</span>
                </div>
                <div class="nav-item" data-page="brain">
                    <i data-lucide="brain"></i>
                    <span>Knowledge Brain</span>
                </div>
                <div class="nav-item" data-page="terminal">
                    <i data-lucide="terminal-square"></i>
                    <span>Terminal</span>
                </div>
                <div class="nav-item" data-page="metrics">
                    <i data-lucide="activity"></i>
                    <span>System Metrics</span>
                </div>
            </div>

            <!-- Features Group -->
            <div class="nav-section">
                <div class="nav-section-label">Features</div>
                <div class="nav-item" data-page="code">
                    <i data-lucide="code-2"></i>
                    <span>Code Analyzer</span>
                    <span class="nav-badge" id="badge-code">Beta</span>
                </div>
                <div class="nav-item" data-page="webhooks">
                    <i data-lucide="webhook"></i>
                    <span>Webhooks</span>
                </div>
                <div class="nav-item" data-page="pipelines">
                    <i data-lucide="git-merge"></i>
                    <span>Pipelines</span>
                </div>
                <div class="nav-item" data-page="prompts">
                    <i data-lucide="library"></i>
                    <span>Prompt Library</span>
                </div>
            </div>

            <!-- Management Group -->
            <div class="nav-section">
                <div class="nav-section-label">System</div>
                <div class="nav-item" data-page="integrations">
                    <i data-lucide="puzzle"></i>
                    <span>Integrations</span>
                </div>
                <div class="nav-item" data-page="backups">
                    <i data-lucide="database-backup"></i>
                    <span>Backups</span>
                </div>
                <div class="nav-item" data-page="settings">
                    <i data-lucide="settings"></i>
                    <span>Configuration</span>
                </div>
            </div>
        </div>

        <div class="sidebar-footer">
            <div class="flex items-center justify-between">
                <div class="flex items-center gap-2">
                    <div class="w-2 h-2 rounded-full active-dot" id="ws-status-dot" style="background: var(--accent-orange)"></div>
                    <span class="text-xs text-muted font-medium" id="ws-status-text">Connecting...</span>
                </div>
                <span class="text-xs text-muted" id="ald-version">v2.1.0</span>
            </div>
        </div>
    </aside>

    <!-- Main Content Area -->
    <main class="main-content">
        
        <!-- Header -->
        <header class="content-header">
            <h1 class="page-title" id="current-page-title">Chat Engine</h1>
            
            <div class="header-actions">
                <button class="btn btn-secondary btn-sm" id="btn-self-heal">
                    <i data-lucide="stethoscope" class="w-4 h-4"></i> Self-Heal
                </button>
                <div class="input-group" style="width: 150px;">
                    <select class="input input-sm" id="model-selector">
                        <option value="openai">GPT-4o</option>
                        <option value="anthropic">Claude-3</option>
                        <option value="gemini">Gemini-Pro</option>
                        <option value="local">Local Model</option>
                    </select>
                </div>
                <div class="input-group" style="width: 120px;">
                    <select class="input input-sm" id="mode-selector">
                        <option value="default">Default</option>
                        <option value="coder">Coder</option>
                        <option value="architect">Architect</option>
                    </select>
                </div>
                <button class="btn btn-icon btn-ghost" id="btn-theme-toggle">
                    <i data-lucide="moon"></i>
                </button>
            </div>
        </header>

        <!-- Pages Container -->
        <div class="content-body" id="pages-container">
            
            <!-- Page: Chat -->
            <div id="page-chat" class="page active">
                <div class="chat-container">
                    <div class="chat-main">
                        <div class="chat-messages" id="chat-messages">
                            <div class="empty-state">
                                <i data-lucide="message-square" class="empty-state-icon"></i>
                                <h3 class="empty-state-title">Welcome to ALD-01 Chat</h3>
                                <p class="empty-state-text">I am your autonomous development assistant. I can write code, analyze systems, run commands, and help build your projects.</p>
                            </div>
                        </div>
                        <div class="chat-input-area border-t border-subtle">
                            <div class="chat-input-wrapper">
                                <button class="btn btn-icon btn-ghost" id="btn-context" title="Context Management">
                                    <i data-lucide="layers"></i>
                                </button>
                                <button class="btn btn-icon btn-ghost" id="btn-upload" title="Upload File">
                                    <i data-lucide="paperclip"></i>
                                </button>
                                <textarea class="chat-input" id="chat-input" placeholder="Message ALD-01... (Shift+Enter for newline)" rows="1"></textarea>
                                <button class="btn btn-primary" id="btn-send">
                                    <i data-lucide="send"></i>
                                </button>
                            </div>
                            <div class="flex justify-between items-center mt-2">
                                <div class="text-xs text-muted" id="chat-tokens">Tokens: ~0</div>
                                <div class="text-xs text-muted" id="typing-indicator" style="display: none;">
                                    ALD-01 is typing <div class="dot-pulse ml-2"><span></span><span></span><span></span></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="chat-sidebar p-4 shrink-0">
                        <h3 class="text-sm font-semibold mb-3">Active Context</h3>
                        <div class="flex flex-col gap-2 mb-4" id="context-list">
                            <div class="card p-3 py-2 text-xs flex justify-between items-center" style="background: rgba(16, 185, 129, 0.1);">
                                <span class="text-green font-medium">Memory Augmented</span>
                                <i data-lucide="check-circle" class="w-3 h-3 text-green"></i>
                            </div>
                        </div>
                        
                        <h3 class="text-sm font-semibold mb-3">Quick Actions</h3>
                        <div class="flex flex-col gap-2">
                            <button class="btn btn-secondary w-full justify-start text-xs" onclick="app.actionExplain()">
                                <i data-lucide="help-circle" class="w-3 h-3"></i> Explain Current File
                            </button>
                            <button class="btn btn-secondary w-full justify-start text-xs" onclick="app.actionOptimize()">
                                <i data-lucide="zap" class="w-3 h-3"></i> Optimize Code
                            </button>
                            <button class="btn btn-secondary w-full justify-start text-xs" onclick="app.actionTests()">
                                <i data-lucide="file-check-2" class="w-3 h-3"></i> Generate Tests
                            </button>
                            <button class="btn btn-danger w-full justify-start text-xs mt-2" onclick="app.clearChat()">
                                <i data-lucide="trash-2" class="w-3 h-3"></i> Clear Chat
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Page: Brain -->
            <div id="page-brain" class="page">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-xl font-semibold">Knowledge Graph</h2>
                    <div class="flex gap-2">
                        <button class="btn btn-secondary btn-sm" onclick="app.refreshBrain()"><i data-lucide="refresh-cw" class="w-4 h-4"></i> Sync</button>
                        <button class="btn btn-primary btn-sm"><i data-lucide="plus" class="w-4 h-4"></i> Add Node</button>
                    </div>
                </div>
                
                <div class="page-grid-3 mb-6">
                    <div class="stat-card">
                        <div class="stat-value" id="stat-brain-nodes">0</div>
                        <div class="stat-label">Total Nodes</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="stat-brain-edges">0</div>
                        <div class="stat-label">Connections</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="stat-brain-types">0</div>
                        <div class="stat-label">Entity Types</div>
                    </div>
                </div>

                <div class="card p-0 overflow-hidden mb-6 card-glow">
                    <div class="brain-canvas" id="brain-network-canvas">
                        <div class="flex items-center justify-center h-full w-full">
                            <span class="text-muted text-sm">Loading graph engine...</span>
                        </div>
                    </div>
                </div>
                
                <div class="card">
                    <div class="card-header pb-0 border-b-0 mb-4">
                        <h3 class="card-title">Recent Knowledge Items</h3>
                    </div>
                    <div class="table-container">
                        <table id="brain-table">
                            <thead>
                                <tr>
                                    <th>Entity Name</th>
                                    <th>Type</th>
                                    <th>Observations</th>
                                    <th>Action</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td colspan="4" class="text-center text-muted">No data loaded</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Page: Metrics -->
            <div id="page-metrics" class="page">
                <div class="flex justify-between items-center mb-5">
                    <h2 class="text-xl font-semibold">System Metrics</h2>
                    <button class="btn btn-secondary btn-sm" onclick="app.refreshMetrics()"><i data-lucide="refresh-cw" class="w-4 h-4"></i></button>
                </div>

                <div class="page-grid-4 mb-6">
                    <div class="stat-card">
                        <div class="stat-value" id="stat-cpu">0%</div>
                        <div class="stat-label">CPU Usage</div>
                        <div class="progress mt-3"><div class="progress-fill" id="prog-cpu" style="width: 0%"></div></div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="stat-mem">0 GB</div>
                        <div class="stat-label">Memory</div>
                        <div class="progress mt-3"><div class="progress-fill" id="prog-mem" style="width: 0%"></div></div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="stat-uptime">0h 0m</div>
                        <div class="stat-label">Uptime</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="stat-active">OK</div>
                        <div class="stat-label">Health Status</div>
                    </div>
                </div>

                <div class="page-grid-2">
                    <div class="card">
                        <h3 class="font-semibold mb-4">API Throughput</h3>
                        <div class="flex justify-between text-sm mb-2">
                            <span class="text-muted">Requests/min</span>
                            <span class="font-medium" id="stat-rpm">0</span>
                        </div>
                        <div class="flex justify-between text-sm mb-2">
                            <span class="text-muted">Error Rate</span>
                            <span class="font-medium text-green" id="stat-err">0.0%</span>
                        </div>
                        <div class="flex justify-between text-sm mb-2">
                            <span class="text-muted">Avg Latency</span>
                            <span class="font-medium" id="stat-lat">0ms</span>
                        </div>
                    </div>
                    <div class="card">
                        <h3 class="font-semibold mb-4">Worker Status</h3>
                        <div class="flex justify-between text-sm mb-2">
                            <span class="text-muted">Active Workers</span>
                            <span class="badge badge-green" id="stat-workers">0/4</span>
                        </div>
                        <div class="flex justify-between text-sm mb-2">
                            <span class="text-muted">Tasks Queued</span>
                            <span class="font-medium" id="stat-queued">0</span>
                        </div>
                        <div class="flex justify-between text-sm mb-2">
                            <span class="text-muted">Tasks Completed</span>
                            <span class="font-medium" id="stat-completed">0</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Page: Code -> Analyzer -->
            <div id="page-code" class="page">
                <div class="flex justify-between items-center mb-5">
                    <h2 class="text-xl font-semibold">Code Analyzer</h2>
                    <div class="flex gap-2">
                        <input type="text" class="input input-sm w-48" id="analyze-path" placeholder="Path (. or /src)">
                        <button class="btn btn-primary btn-sm" onclick="app.runCodeAnalysis()">
                            <i data-lucide="play" class="w-4 h-4"></i> Run Scan
                        </button>
                    </div>
                </div>

                <!-- Analysis Results (Hidden by default) -->
                <div class="empty-state" id="analysis-empty">
                    <i data-lucide="code-2" class="empty-state-icon"></i>
                    <h3 class="empty-state-title">No Analysis Data</h3>
                    <p class="empty-state-text">Enter a directory or file path and click "Run Scan" to perform static code analysis.</p>
                </div>

                <div id="analysis-results" style="display: none;">
                    <div class="page-grid-4 mb-6">
                        <div class="stat-card">
                            <div class="stat-value" id="ana-score">0</div>
                            <div class="stat-label">Quality Score</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="ana-files">0</div>
                            <div class="stat-label">Files Analyzed</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value text-red" id="ana-sec">0</div>
                            <div class="stat-label">Security Alerts</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value text-yellow" id="ana-complex">0</div>
                            <div class="stat-label">High Complexity</div>
                        </div>
                    </div>

                    <div class="page-grid-2">
                        <div class="card">
                            <h3 class="card-title mb-4">Security Hotspots</h3>
                            <div class="table-container">
                                <table id="sec-hotspots-table">
                                    <thead><tr><th>File</th><th>Issue</th><th>Severity</th></tr></thead>
                                    <tbody id="sec-hotspots-body"></tbody>
                                </table>
                            </div>
                        </div>
                        <div class="card">
                            <h3 class="card-title mb-4">Improvement Suggestions</h3>
                            <ul class="flex flex-col gap-3" id="ana-suggestions"></ul>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Page: Webhooks -->
            <div id="page-webhooks" class="page">
                <div class="flex justify-between items-center mb-5">
                    <h2 class="text-xl font-semibold">Webhook Integrations</h2>
                    <button class="btn btn-primary btn-sm" onclick="app.showWebhookModal()">
                        <i data-lucide="plus" class="w-4 h-4"></i> Add Webhook
                    </button>
                </div>
                <div class="card p-0 overflow-hidden">
                    <table class="w-full">
                        <thead>
                            <tr>
                                <th>Status</th>
                                <th>URL</th>
                                <th>Events</th>
                                <th>Stats</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="webhooks-table">
                            <!-- Filled dynamically -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Page: Terminal -->
            <div id="page-terminal" class="page">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-xl font-semibold">Command Terminal</h2>
                    <button class="btn btn-secondary btn-sm" onclick="app.clearTerminal()">
                        <i data-lucide="trash-2" class="w-4 h-4"></i> Clear output
                    </button>
                </div>
                
                <div class="terminal mb-4">
                    <div class="terminal-header">
                        <div class="terminal-dot red"></div>
                        <div class="terminal-dot yellow"></div>
                        <div class="terminal-dot green"></div>
                        <span class="ml-2 text-xs text-muted" id="term-cwd">~/ald-01</span>
                    </div>
                    <div class="terminal-body" id="term-output">
                        <div class="terminal-line"><span class="terminal-info">ALD-01 Sandbox Executor v1.0 connected.</span></div>
                    </div>
                </div>

                <div class="flex gap-2">
                    <input type="text" class="input font-mono flex-1" id="term-input" placeholder="Enter command (e.g. ls -la, python script.py)...">
                    <button class="btn btn-primary" id="btn-term-run">Execute</button>
                </div>
            </div>

            <!-- Page: Settings -->
            <div id="page-settings" class="page">
                <div class="flex justify-between items-center mb-5">
                    <h2 class="text-xl font-semibold">Configuration</h2>
                    <button class="btn btn-primary btn-sm" onclick="app.saveConfig()">
                        <i data-lucide="save" class="w-4 h-4"></i> Save All
                    </button>
                </div>
                
                <div class="page-grid-2">
                    <div class="card">
                        <h3 class="card-title mb-4">Preferences</h3>
                        <div class="flex flex-col gap-4">
                            <div class="flex justify-between items-center">
                                <div>
                                    <div class="font-medium">Dark Mode</div>
                                    <div class="text-xs text-muted">Use dark theme across entire UI</div>
                                </div>
                                <label class="toggle">
                                    <input type="checkbox" id="pref-dark" checked>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                            <div class="flex justify-between items-center">
                                <div>
                                    <div class="font-medium">Auto-Healing</div>
                                    <div class="text-xs text-muted">Allow ALD to fix errors automatically</div>
                                </div>
                                <label class="toggle">
                                    <input type="checkbox" id="pref-heal" checked>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                            <div class="flex justify-between items-center">
                                <div>
                                    <div class="font-medium">Verbose Logs</div>
                                    <div class="text-xs text-muted">Detailed terminal logging output</div>
                                </div>
                                <label class="toggle">
                                    <input type="checkbox" id="pref-verbose">
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                        </div>
                    </div>
                    
                    <div class="card">
                        <h3 class="card-title mb-4">Export Data</h3>
                        <div class="flex flex-col gap-3">
                            <button class="btn btn-secondary w-full justify-center" onclick="app.exportData('brain')">Export Brain (JSON)</button>
                            <button class="btn btn-secondary w-full justify-center" onclick="app.exportData('chat')">Export Conversation (Markdown)</button>
                            <button class="btn btn-secondary w-full justify-center text-accent" onclick="app.exportData('full')">Export Full System State</button>
                        </div>
                    </div>
                </div>
            </div>

        </div> <!-- /content-body -->
    </main>
</div>

<!-- Modal: Add Webhook -->
<div class="modal-overlay" id="modal-webhook">
    <div class="modal">
        <div class="modal-header">
            <h3 class="modal-title">Register Webhook</h3>
            <button class="modal-close" onclick="app.closeModal('webhook')"><i data-lucide="x"></i></button>
        </div>
        <div class="flex flex-col gap-4">
            <div class="input-group">
                <label class="input-label">Payload URL</label>
                <input type="url" id="wh-url" class="input" placeholder="https://api.example.com/webhook">
            </div>
            <div class="input-group">
                <label class="input-label">Events to subscribe</label>
                <input type="text" id="wh-events" class="input" placeholder="* for all, or chat.message, system.error">
            </div>
            <div class="input-group">
                <label class="input-label">HMAC Secret (Optional)</label>
                <input type="password" id="wh-secret" class="input" placeholder="To sign payloads securely">
            </div>
            <div class="flex justify-end gap-3 mt-4">
                <button class="btn btn-secondary" onclick="app.closeModal('webhook')">Cancel</button>
                <button class="btn btn-primary" onclick="app.createWebhook()">Create Webhook</button>
            </div>
        </div>
    </div>
</div>

<!-- Toasts Container -->
<div class="toast-container" id="toast-container"></div>

<!-- Scripts -->
<script src="/static/app.js"></script>
<script>
    // Initialize Lucide icons mapping
    lucide.createIcons();
</script>
</body>
</html>
